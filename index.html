<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Live Cam</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0b5cff">

<style>
body {
    margin: 0;
    background: #0f172a;
    color: #fff;
    font-family: Arial, sans-serif;
}
header {
    background: #0b5cff;
    padding: 12px;
    text-align: center;
    font-weight: bold;
}
#controls {
    padding: 10px;
    text-align: center;
}
button {
    padding: 10px 16px;
    border: none;
    background: #0b5cff;
    color: #fff;
    font-size: 15px;
    border-radius: 6px;
    cursor: pointer;
}
button:disabled {
    background: #555;
    cursor: not-allowed;
}
#link {
    margin-top: 10px;
    word-break: break-all;
    font-size: 14px;
    color: #22c55e;
}
#videos {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px;
    justify-content: center;
}
video {
    width: 200px;
    background: black;
    border-radius: 8px;
}
.status {
    font-size: 13px;
    color: #94a3b8;
    margin-top: 5px;
}
</style>
</head>

<body>
<header>ðŸ“¡ Live Cam</header>

<div id="controls">
    <button id="btnLink" disabled>ðŸ”— Gerar Link</button>
    <div class="status" id="status">Inicializando conexÃ£o...</div>
    <div id="link"></div>
</div>

<div id="videos"></div>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<script>
const videos = document.getElementById("videos");
const linkDiv = document.getElementById("link");
const btnLink = document.getElementById("btnLink");
const statusEl = document.getElementById("status");

let peerId;
let localStream;

const peer = new Peer();

/* Abrir cÃ¢mera */
async function startCamera() {
    if (localStream) return localStream;
    localStream = await navigator.mediaDevices.getUserMedia({
        video: true,
        audio: true
    });
    addVideo(localStream, true);
    return localStream;
}

/* Adicionar vÃ­deo */
function addVideo(stream, muted = false) {
    const video = document.createElement("video");
    video.srcObject = stream;
    video.autoplay = true;
    video.playsInline = true;
    video.muted = muted;
    videos.appendChild(video);
}

/* Peer conectado */
peer.on("open", async id => {
    peerId = id;
    btnLink.disabled = false;
    statusEl.innerText = "Conectado. Aguardando visitante...";

    const params = new URLSearchParams(location.search);
    const room = params.get("r");

    if (room) {
        await startCamera();
        const call = peer.call(room, localStream);
        call.on("stream", remoteStream => {
            addVideo(remoteStream);
        });
    }
});

/* Receber chamada */
peer.on("call", async call => {
    await startCamera();
    call.answer(localStream);
    call.on("stream", remoteStream => {
        addVideo(remoteStream);
        statusEl.innerText = "Visitante conectado";
    });
});

/* Gerar link */
btnLink.onclick = () => {
    const url = `${location.origin}${location.pathname}?r=${peerId}`;
    linkDiv.innerText = url;
    navigator.clipboard.writeText(url);
    statusEl.innerText = "Link gerado. Aguardando acesso...";
};
</script>

</body>
</html>
